# Telegram Bot for Video Analytics

Бот принимает вопросы на русском языке и возвращает числовые метрики по видео из внутренней базы данных.

## Основные возможности

- Отвечает на вопросы вида:
  - «Сколько всего видео есть в системе?»
  - «Сколько видео набрало больше 100 000 просмотров за всё время?»
  - «На сколько просмотров в сумме выросли все видео 28 ноября 2025?»
- Использует локальную LLM (Ollama) для трансляции естественного языка в SQL-запрос.
- Работает с двумя таблицами: `videos` (финальная статистика) и `video_snapshots` (почасовые замеры).

 Требования

- Python 3.9+
- Docker
- Ollama (https://ollama.com/)

 Запуск

1. Запустите PostgreSQL через Docker:
   ```bash
   docker-compose up -d
   ```

2. **Скачайте LLM-модель:**
   ```bash
   ollama pull llama3:8b
   ```

3. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Загрузите данные в БД**  
   Убедитесь, что `videos.json` лежит в корне проекта, затем:
   ```bash
   python init_db.py
   ```

5. **Настройте Telegram-токен**  
   В файле `bot.py` замените:
   ```python
   BOT_TOKEN = "YOUR_BOT_TOKEN_HERE"
   ```

6. **Запустите бота:**
   ```bash
   python bot.py
   ```

> Убедитесь, что `ollama serve` запущен в фоне (обычно запускается автоматически при первом `ollama pull`).

 Архитектура

- **Исходные данные** — JSON-файл с видео и вложенными снапшотами.
- **Хранилище** — PostgreSQL (`videos`, `video_snapshots`).
- **NLU → SQL** — локальная LLM (`llama3:8b`) с жёстко заданным промтом.
- **API** — Telegram Bot API через `aiogram`.

 Проверка

После запуска бота проверьте:
```sql
SELECT COUNT(*) FROM videos;
```
Значение должно совпадать с количеством видео в JSON.  
Пример запроса к боту:  
> «Сколько всего видео есть в системе?» → бот должен вернуть число > 0.
```